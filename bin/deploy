#!/bin/bash
set -e

echo "ğŸš€ Deploying urielm.dev..."

# Pull latest image from Docker Hub
echo "ğŸ“¦ Pulling latest image..."
docker-compose pull

# Stop old container
echo "ğŸ›‘ Stopping old container..."
docker-compose down

# Start new container
echo "â–¶ï¸  Starting new container..."
docker-compose up -d

# Wait for health check
echo "â³ Waiting for container to be healthy..."
sleep 10

# Run migrations
echo "ğŸ—„ï¸  Running migrations..."
docker-compose exec -T web bin/urielm eval "Urielm.Release.migrate()"

# Show status
echo "âœ… Deployment complete!"
docker-compose ps

echo ""
echo "ğŸŒ Site: https://urielm.dev"
echo "ğŸ“Š Logs: docker-compose logs -f"
